<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VidaExtra® - Calculadora AC-4</title>
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#0d6efd">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="/manifest.json">
  
  <!-- Bootstrap e Ícones -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  
  <!-- CSS Local -->
  <link rel="stylesheet" href="style.css">
  
  <!-- Favicon usando a mesma imagem do operador -->
  <link rel="icon" href="operador.jpg" type="image/jpeg">
</head>
<body>
  <div class="container py-4">
    <div class="text-center mb-4">
      <img src="operador.jpg" alt="Operador" class="img-topo mb-3">
      <h1 class="text-gradient fw-bold"><i class="bi bi-shield-lock"></i> VidaExtra<sup>®</sup></h1>
      <p class="text-muted">Calculadora de horas extras - AC-4</p>
    </div>

    <div class="row g-4">
      <!-- Formulário -->
      <div class="col-lg-6">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-primary text-white">
            <i class="bi bi-calculator"></i> Dados do Serviço
          </div>
          <div class="card-body">
            <form id="form-calculo">
              <div class="mb-3">
                <label class="form-label fw-bold">Data</label>
                <input type="date" id="data-servico" class="form-control" required>
              </div>
              
              <div class="row g-2 mb-3">
                <div class="col-md-6">
                  <label class="form-label fw-bold">Hora Inicial</label>
                  <input type="time" id="hora-inicio" class="form-control" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-bold">Hora Final</label>
                  <input type="time" id="hora-fim" class="form-control" required>
                </div>
              </div>

              <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="pensao-alimenticia">
                <label class="form-check-label fw-bold" for="pensao-alimenticia">
                  <i class="bi bi-exclamation-triangle text-warning"></i> Desconto de Pensão Alimentícia
                </label>
              </div>

              <div id="pensao-container" class="mb-3 p-3 bg-light rounded" style="display: none;">
                <label class="form-label fw-bold">Percentual de Desconto (%)</label>
                <input type="number" id="percentual-pensao" class="form-control" min="1" max="100" value="30">
              </div>

              <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary">
                  <i class="bi bi-calculator"></i> Calcular
                </button>
                <button type="button" id="btn-limpar" class="btn btn-outline-danger">
                  <i class="bi bi-trash"></i> Limpar Tudo
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Resultado -->
      <div class="col-lg-6">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-success text-white">
            <i class="bi bi-cash-stack"></i> Resultado
          </div>
          <div class="card-body">
            <div id="resultado-container" style="display: none;">
              <div class="alert alert-info" id="resumo-periodo"></div>
              
              <div class="table-responsive">
                <table class="table table-sm">
                  <thead class="table-light">
                    <tr>
                      <th>Horas</th>
                      <th>Total</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td id="horas-diurnas">0</td>
                      <td id="total-diurno" class="fw-bold">R$ 0,00</td>
                    </tr>
                    <tr class="table-secondary">
                      <td class="fw-bold">TOTAL BRUTO</td>
                      <td id="total-bruto" class="fw-bold">R$ 0,00</td>
                    </tr>
                    <tr id="linha-pensao" style="display: none;">
                      <td>Desconto Pensão</td>
                      <td id="desconto-pensao" class="text-danger fw-bold">- R$ 0,00</td>
                    </tr>
                    <tr class="table-success">
                      <td class="fw-bold">TOTAL LÍQUIDO</td>
                      <td id="total-liquido" class="fw-bold">R$ 0,00</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div id="resultado-vazio" class="text-center py-5 text-muted">
              <i class="bi bi-calculator display-6"></i>
              <p class="mt-3">Preencha os dados para calcular</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Histórico -->
    <div class="card shadow-sm border-0 mt-4">
      <div class="card-header bg-primary text-white">
        <i class="bi bi-clock-history"></i> Histórico
      </div>
      <div class="card-body">
        <div id="historico-lista" class="list-group"></div>
        <div id="historico-vazio" class="text-center py-3 text-muted">
          Nenhum cálculo registrado ainda
        </div>
        
        <div id="total-acumulado" class="alert alert-success mt-3" style="display: none;">
          <strong>Total Acumulado:</strong> <span id="total-horas-valor">0h</span> | <span id="total-valor-acumulado">R$ 0,00</span>
        </div>
      </div>
    </div>

    <!-- Botão Exportar PDF -->
    <div class="d-grid mt-3">
      <button type="button" id="btn-exportar" class="btn btn-outline-success">
        <i class="bi bi-file-earmark-pdf"></i> Exportar PDF
      </button>
    </div>
  </div>

  <footer class="bg-dark text-white text-center py-3 mt-4">
    <div class="container">
      <p class="mb-0">
        Desenvolvido por <strong>CB Antônio Rafael</strong> - 14ª CIPM
      </p>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="app.js"></script>
  
  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => {
            console.log('ServiceWorker registrado com sucesso:', registration.scope);
            
            // Verifica se há uma nova versão disponível
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed') {
                  if (navigator.serviceWorker.controller) {
                    // Nova versão disponível
                    Swal.fire({
                      title: 'Nova versão disponível!',
                      text: 'Deseja atualizar o aplicativo agora?',
                      icon: 'info',
                      showCancelButton: true,
                      confirmButtonColor: '#0d6efd',
                      cancelButtonColor: '#6c757d',
                      confirmButtonText: 'Atualizar',
                      cancelButtonText: 'Depois'
                    }).then((result) => {
                      if (result.isConfirmed) {
                        newWorker.postMessage({action: 'skipWaiting'});
                        window.location.reload();
                      }
                    });
                  }
                }
              });
            });
          })
          .catch(err => {
            console.error('Falha no registro do ServiceWorker:', err);
          });
      });
    }
  </script>
</body>
</html>